# Sprint Manifest: Config Alignment

> Generated: 2026-02-26
> Status: **Active**
> Started: 2026-02-26
> Hydrated: 2026-02-26

## Overview

- **Branch**: sprint/v1.0.0-rc.5-config-alignment
- **Target Version**: v1.0.0-rc.4 â†’ v1.0.0-rc.5 (PATCH)
- **Focus Area**: Configuration Format Consistency
- **Estimated Scope**: Medium (1 session)

## Issues Addressed

### Must Complete
- [x] #37: Align config format with existing CAMI workspace (YAML, not JSON)
- [x] #35: Implement CAMI_WORKSPACE_PATH environment variable support
- [x] #34: Standardize manifest format (capabilities vs deployed)

### Nice to Have
- None

## Acceptance Criteria

- [x] All skills reference `config.yaml` (not `config.json`)
- [x] Schema matches existing CAMI format: `agent_sources`, `deploy_locations`
- [x] All skills check `$CAMI_WORKSPACE_PATH` before using default
- [x] Single manifest format documented and used across all skills
- [x] `reference/config-schema.md` documents the ACTUAL existing format
- [x] Existing CAMI workspaces work without migration (auto-migration added)

## Dependencies

- None (foundational work)

## Parallel Work Considerations

### Sprint Scope (Files to Modify)
- `skills/manage-sources/SKILL.md`
- `skills/manage-capabilities/SKILL.md`
- `skills/create-project/SKILL.md`
- `skills/cami/SKILL.md`
- `reference/config-schema.md`

### Protected Areas
- No other work should modify skill files during this sprint

## Git Workflow

- **Branch from**: main
- **Branch name**: sprint/v1.0.0-rc.5-config-alignment
- **Commit prefix**: [config]
- **PR template**: Standard

## Rollback Plan

- Each issue has atomic commits
- Can revert individual issues if needed
- Full rollback: git revert to v1.0.0-rc.4

---

## Full Issue Details

> Hydrated on: 2026-02-26
> Source: GitHub Issues (lando-labs/cami-plugin)

---

### Issue #37: Align config format with existing CAMI workspace (YAML, not JSON)

**Labels**: None
**State**: Open

#### Description

The plugin was designed with a new `config.json` format instead of matching the existing CAMI workspace format (`config.yaml`). This breaks compatibility with existing users.

**This was not intentional** - the plugin should have been built for parity with the existing CAMI system.

#### Existing Format (What Users Have)

File: `~/cami-workspace/config.yaml`

```yaml
version: "1"
install_timestamp: 2025-11-20T17:37:36.626242873-06:00
setup_complete: true
agent_sources:
  - name: my-agents
    type: local
    path: /Users/lando/cami-workspace/sources/my-agents
    priority: 10
    git:
      enabled: false
  - name: fullstack-guild
    type: local
    path: /Users/lando/cami-workspace/sources/fullstack-guild
    priority: 40
    git:
      enabled: true
deploy_locations:
  - name: phaser-mcp
    path: /Users/lando/lando-labs/phaser-mcp
```

Also: `deployments.yaml` for detailed deployment tracking.

#### Plugin Currently Expects (Wrong)

File: `config.json`

```json
{
  "version": "1.0.0",
  "sources": [...],
  "deployments": [...]
}
```

#### What Needs to Change

| Current (Wrong) | Should Be |
|-----------------|-----------|
| `config.json` | `config.yaml` |
| `sources` | `agent_sources` |
| `deployments` | `deploy_locations` |
| JSON format | YAML format |

#### Files to Update

All skills that reference config:
- `skills/cami/SKILL.md` - Already says YAML (correct)
- `skills/manage-sources/SKILL.md` - Says JSON (fix)
- `skills/manage-capabilities/SKILL.md` - Says JSON (fix)
- `skills/create-project/SKILL.md` - Says JSON (fix)
- `reference/config-schema.md` - Complete rewrite to match existing format

#### Acceptance Criteria

- [ ] All skills reference `config.yaml`
- [ ] Schema matches existing CAMI format exactly
- [ ] Field names match: `agent_sources`, `deploy_locations`
- [ ] Existing workspaces work without migration
- [ ] `reference/config-schema.md` documents the ACTUAL format

---

### Issue #35: Implement CAMI_WORKSPACE_PATH environment variable support

**Labels**: None
**State**: Open

#### Description

The README documents `CAMI_WORKSPACE_PATH` environment variable support, but skills don't actually check for it. They hardcode `~/cami-workspace` everywhere.

#### Current State

**README.md promises:**
```bash
export CAMI_WORKSPACE_PATH=~/my-custom-workspace
```
> "CAMI will use this path instead of `~/cami-workspace/`."

**Skills actually do:**
- Hardcode `~/cami-workspace/` in all paths
- No env var checking documented in skill instructions

#### Affected Skills

All skills reference `~/cami-workspace`:
- `cami/SKILL.md` - workspace creation, detection
- `manage-sources/SKILL.md` - git clone paths, config reading
- `manage-capabilities/SKILL.md` - config reading
- `create-agent/SKILL.md` - save targets
- `create-project/SKILL.md` - tracked locations

#### Implementation

Add to each skill that references workspace path:

```markdown
## Workspace Path Resolution

The workspace location can be customized. Before using workspace path:

1. Check environment variable: `echo $CAMI_WORKSPACE_PATH`
2. If set and non-empty, use that path
3. If not set, use default `~/cami-workspace`

Example:
- User has `CAMI_WORKSPACE_PATH=~/my-workspace`
- Use `~/my-workspace/config.yaml` not `~/cami-workspace/config.yaml`
- Use `~/my-workspace/sources/` not `~/cami-workspace/sources/`
```

#### Related

- Issue #37 - Config format alignment (use YAML, match existing schema)

#### Acceptance Criteria

- [ ] All skills check for CAMI_WORKSPACE_PATH before using default
- [ ] Workspace creation respects env var
- [ ] Config/manifest paths respect env var
- [ ] Testing guide updated with isolation instructions

---

### Issue #34: Standardize manifest format (capabilities vs deployed)

**Labels**: None
**State**: Open

#### Description

The cami-manifest.yaml format is inconsistent between skills. Need to standardize on one format.

#### Current Inconsistency

**manage-capabilities/SKILL.md** uses:
```yaml
capabilities:
  agents:
    - name: frontend-methodology
      version: 1.1.0
      source: fullstack-guild
      added_at: 2026-02-25T10:30:00Z
      content_hash: sha256:abc123def...
```

**create-project/SKILL.md** uses:
```yaml
deployed:
  agents:
    - name: frontend-methodology
      version: 1.2.0
      source: fullstack-guild
      deployed_at: [timestamp]
      specialty: React architecture decisions
```

#### Differences

| Aspect | manage-capabilities | create-project |
|--------|---------------------|----------------|
| Root key | `capabilities` | `deployed` |
| Timestamp | `added_at` | `deployed_at` |
| Hash tracking | `content_hash` | (none) |
| Agent metadata | (none) | `specialty` |

#### Needs Decision

1. Which root key? (`capabilities` vs `deployed` vs something else)
2. Which timestamp field? (`added_at` vs `deployed_at`)
3. Should we include `content_hash` for change detection?
4. Should we include agent metadata like `specialty`?

#### Acceptance Criteria

- [ ] Single manifest format documented
- [ ] All skills updated to use same format
- [ ] Schema documented in reference/config-schema.md

---

## Implementation Order

**Recommended sequence:**

1. **#34 first** - Decide on manifest format (quick decision, then document)
2. **#37 second** - Update all skills with correct config format (bulk of work)
3. **#35 third** - Add env var resolution to all skills (add section to each)

This order makes sense because:
- #34 is a decision + documentation (clears the path)
- #37 is the main compatibility fix (touches all skills anyway)
- #35 can be added as a new section while we're already editing skills

## Key Files to Read First

Before implementing, read these to understand current state:
- `skills/manage-sources/SKILL.md`
- `skills/manage-capabilities/SKILL.md`
- `skills/create-project/SKILL.md`
- `reference/config-schema.md`
